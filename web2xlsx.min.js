/**
 * @license
 * Copyright (c) 2020 Rajit Roy
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
function realBackgroundColor(t){if(!t)return"rgb(255, 255, 255)";var e=getComputedStyle(t).backgroundColor;return"rgba(0, 0, 0, 0)"===e||"transparent"===e?"HTML"===t.nodeName?"rgb(255, 255, 255)":realBackgroundColor(t.parentElement):e}function rgb2argb(t){var e=t;try{if(/^#[0-9A-F]{6}$/i.test(e))return e;function r(t){return("0"+parseInt(t).toString(16)).slice(-2)}return"ff"+r((e=e.match(/^rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)$/))[1])+r(e[2])+r(e[3])}catch(e){return t}}function timeConverter(t){var e=new Date(t),r=e.getFullYear(),n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][e.getMonth()],o=e.getDate();return o<10?n+" 0"+o+", "+r:n+" "+o+", "+r}function numberCounter(t){"use strict";var e=t%26,r=t/26|0,n=e?String.fromCharCode(64+e):(--r,"Z");return r?numberCounter(r)+n:n}var web2xlsx=function(t,e){try{t.funcAtStart}catch(t){console.error("ERROR: Error at 'initFuncAtStart'"),console.error(t)}if(t={fileName:t.fileName||"Excel Export on "+timeConverter(Date.now()),initFuncAtStart:t.initFuncAtStart||null,initFuncAtEnd:t.initFuncAtEnd||null},e=e||null){for(var r=new ExcelJS.Workbook,n=0;n<e.length;n++)e[n]={tableID:e[n].tableID,colExclude:e[n].colExclude||[],rowExclude:e[n].rowExclude||[],funcAtStart:e[n].funcAtStart||null,funcAtEnd:e[n].funcAtEnd||null,consoleLogIteration:e[n].consoleLogIteration||!1,defaultWidth:e[n].defaultWidth||9,sheetDetails:e[n].sheetDetails||{sheetName:null,sheetTabColor:null},customWidth:e[n].customWidth||[{col:null,width:null}],wrap:e[n].wrap||!1},tableIterator(r,e[n],n);r.xlsx.writeBuffer().then(e=>window.saveAs(new Blob([e]),`${t.fileName}.xlsx`)).catch(t=>console.error("Error writing excel export",t))}try{t.initFuncAtEnd}catch(t){console.error("ERROR: Error at 'initFuncAtEnd'"),console.error(t)}};function getStyles(t,e){e["background-color"]=rgb2argb(realBackgroundColor(t[0])),e.color=rgb2argb(t.css("color")),e.style={bold:!1,italics:!1,underline:!1,size:11,family:"Calibri"},parseInt(t.css("font-weight"))>=700&&(e.style.bold=!0),t.css("font-style").includes("italic")&&(e.style.italics=!0);try{e.style.size=t.css("font-size").split("px")[0]}catch(t){e.style.size=11}t.css("text-decoration").split(" ").includes("underline")&&(e.style.underline=!0);try{e.style.family=t.css("font-family").split(",")[0].replace(/['"]/g,"")}catch(t){e.style.family="sans-serif"}return e}function tableIterator(t,e,r){try{e.funcAtStart}catch(t){console.error("ERROR: Error at 'funcAtStart'"),console.error(t)}var n={},o=[],l=[],i=[],c=0,a=0,s=0,d=$(e.tableID+" > tbody > tr").length-e.rowExclude.length,u=$(e.tableID+" > tbody > tr:eq(0) > td").length-e.colExclude.length;try{$(e.tableID+" > thead > tr > th").each(function(){if(!e.colExclude.includes($(this).parent().children().index($(this)).toString().trim())){var t={};t.index=c++-1,t.val=$(this).text().trim(),t.col=$(this).parent().children().index($(this)),t.colIndex=++t.index,t.colWidth=e.defaultWidth,e.customWidth.forEach(function(e){t.index===e.col&&(t.colWidth=e.width)}),t.excelIndex=numberCounter(1+t.colIndex)+"1",t=getStyles($(this),t),o.push(t)}})}catch(t){console.error("Error at thead reading"),console.error(t)}try{$(e.tableID+" > tbody > tr > td").each(function(){if(!e.colExclude.includes($(this).parent().children().index($(this)).toString().trim())&&!e.rowExclude.includes($(this).parent().parent().children().index($(this).parent()).toString().trim())){var t={};t.index=a++,t.val=$(this).text().trim(),t.col=$(this).parent().children().index($(this)),t.row=$(this).parent().parent().children().index($(this).parent()),t.colIndex=numberCounter(1+t.index%u),t.rowIndex=2+Math.floor(t.index/u),t.excelIndex=t.colIndex+t.rowIndex,t=getStyles($(this),t),l.push(t)}})}catch(t){console.error("Error at tbody reading"),console.error(t)}try{$(e.tableID+" > tfoot > tr > td").each(function(){if(!e.colExclude.includes($(this).parent().children().index($(this)).toString().trim())){var t={};t.index=s++-1,t.val=$(this).text().trim(),t.col=$(this).parent().children().index($(this)),t.colIndex=++t.index,t.excelIndex=numberCounter(1+t.colIndex)+(d+2),t=getStyles($(this),t),i.push(t)}})}catch(t){console.error("Error at tfoot reading"),console.error(t)}n.head=o,n.body=l,n.foot=i,n.totalBodyRows=d,n.totalBodyCols=u,c=0,a=0,s=0,e.consoleLogIteration&&console.log(JSON.stringify(n)),excelCreateAndExport(t,n,e,r)}function excelCreateAndExport(t,e,r,n){var o,l;o=r.sheetDetails.sheetName?r.sheetDetails.sheetName:"Sheet"+(n+1).toString(),l=r.sheetDetails.sheetTabColor?"FF"+r.sheetDetails.sheetTabColor.split("#")[1]:"FFFFFFFF";var i=t.addWorksheet(o,{properties:{tabColor:{argb:l}},views:[{state:"frozen",ySplit:1}]}),c=e.head,a=e.body,s=e.foot,d=[],u=1;r.defaultWidth<=0&&(r.defaultWidth=9),c.forEach(function(t){var e={header:t.val,key:numberCounter(u++),width:t.colWidth||9};d.push(e)}),i.columns=d;var h=function(t,e){return"ffffffff"!==e["background-color"]&&(t.getCell(e.excelIndex).fill=function(t){return{type:"pattern",pattern:"solid",fgColor:{argb:t["background-color"]}}}(e)),t.getCell(e.excelIndex).font=function(t){return{color:{argb:t.color},name:t.style.family,family:2,bold:t.style.bold,underline:t.style.underline,italic:t.style.italics}}(e),r.wrap?t.getCell(e.excelIndex).alignment={vertical:"middle",wrapText:!0}:t.getCell(e.excelIndex).alignment={vertical:"middle"},t},f=function(t,e){return""===e.val?e.val="":isNaN(e.val.replace(/,/g,""))?t.getCell(e.excelIndex).value=e.val:t.getCell(e.excelIndex).value=parseInt(e.val),t};a.forEach(function(t){i=f(i,t),i=h(i,t)}),c.forEach(function(t){i=h(i,t)}),s.forEach(function(t){i=f(i,t),i=h(i,t)}),c.concat(a).concat(s).forEach(function(t){i.getCell(t.excelIndex).border={top:{style:"thin",color:{argb:"FFD4D4D4"}},left:{style:"thin",color:{argb:"FFD4D4D4"}},bottom:{style:"thin",color:{argb:"FFD4D4D4"}},right:{style:"thin",color:{argb:"FFD4D4D4"}}}});try{r.funcAtEnd}catch(t){console.error("ERROR: Error at 'funcAtEnd'"),console.error(t)}}